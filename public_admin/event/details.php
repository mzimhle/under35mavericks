<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/** * Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/** * Check for login */require_once 'includes/auth.php';/* objects. */require_once 'class/event.php';$eventObject 				= new class_event();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$eventData = $eventObject->getByCode($code);	if(!$eventData) {		header('Location: /event/');		exit;	}	$smarty->assign('eventData', $eventData);}/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;	$areaByName	= NULL;		if(isset($_POST['event_name']) && trim($_POST['event_name']) == '') {		$errorArray['event_name'] = 'Name required';		$formValid = false;			}		if(isset($_POST['event_description']) && trim($_POST['event_description']) == '' ) {		$errorArray['event_description'] = 'Description is required';		$formValid = false;			} else if(strlen(trim($_POST['event_description'])) < 0 || strlen(trim($_POST['event_description'])) > 255) {		$errorArray['event_description'] = 'characters need to be less than 200 characters';		$formValid = false;				}		if(isset($_POST['event_address']) && trim($_POST['event_address']) == '') {		$errorArray['event_address'] = 'Address required';		$formValid = false;			}		if(isset($_POST['event_startdate']) && trim($_POST['event_startdate']) == '') {		$errorArray['event_startdate'] = 'End date and time required';		$formValid = false;			}		if(isset($_POST['event_enddate']) && trim($_POST['event_enddate']) == '') {		$errorArray['event_enddate'] = 'End date and time required';		$formValid = false;			}		if(isset($_POST['event_page']) && trim($_POST['event_page']) == '' ) {		$errorArray['event_page'] = 'Description is required';		$formValid = false;			} else if(strlen(trim($_POST['event_page'])) < 255) {		$errorArray['event_page'] = 'Page needs to be more information than entered.';		$formValid = false;				}		if(count($errorArray) == 0 && $formValid == true) {				$data 	= array();							$data['event_name']					= trim($_POST['event_name']);		$data['event_description']			= trim($_POST['event_description']);			$data['event_address']				= trim($_POST['event_address']);					$data['event_startdate']				= trim($_POST['event_startdate']);		$data['event_enddate']				= trim($_POST['event_enddate']);		$data['event_page']					= htmlspecialchars_decode(stripslashes(trim($_POST['event_page'])));				if(isset($eventData)) {			/*Update. */			$where		= $eventObject->getAdapter()->quoteInto('event_code = ?', $eventData['event_code']);			$success	= $eventObject->update($data, $where);									$success	= $eventData['event_code'];		} else {					$success = $eventObject->insert($data);					}		if(count($errorArray) == 0) {										header('Location: /event/');				exit;				}				}		/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	}$smarty->display('event/details.tpl');?>