<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/*** Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/*** Check for login */require_once 'includes/auth.php';/* objects. */require_once 'class/application.php';require_once 'class/category.php';require_once 'class/year.php';$applicationObject 	= new class_application();$categoryObject 	= new class_category();$yearObject 			= new class_year();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$applicationData = $applicationObject->getByCode($code);	if($applicationData) {		$smarty->assign('applicationData', $applicationData);	} else {		header('Location: /awards/entryapplication/');		exit;			}}$categoryData = $categoryObject->pairs();if($categoryData) $smarty->assign('categoryData', $categoryData);$yearData = $yearObject->pairs();if($yearData) $smarty->assign('yearData', $yearData);/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;	$areaByName	= NULL;		/* People details. */		if(isset($_POST['year_code']) && trim($_POST['year_code']) == '') {		$errorArray['year_code'] = 'Application year is required';		$formValid = false;			}		if(isset($_POST['application_name']) && trim($_POST['application_name']) == '') {		$errorArray['application_name'] = 'Name required';		$formValid = false;			}		if(isset($_POST['application_surname']) && trim($_POST['application_surname']) == '') {		$errorArray['application_surname'] = 'surname required';		$formValid = false;			}		if(isset($_POST['application_title']) && trim($_POST['application_title']) == '') {		$errorArray['application_title'] = 'Business title of applicant required';		$formValid = false;			}		if(isset($_POST['application_email']) && trim($_POST['application_email']) != '') {		if($applicationObject->validateEmail(trim($_POST['application_email'])) == '') {			$errorArray['application_email'] = 'Needs to be a valid email address';			$formValid = false;			} /* else {						$email = isset($applicationData) ? $applicationData['application_code'] : null;						$emailData = $applicationObject->getByEmail(trim($_POST['application_email']), $email);			if($emailData) {				$errorArray['application_email'] = 'Email already exists';				$formValid = false;							}		} */	}	 	if(isset($_POST['application_cellphone']) && trim($_POST['application_cellphone']) != '') {		if($applicationObject->validateCell(trim($_POST['application_cellphone'])) == '') {			$errorArray['application_cellphone'] = 'Needs to be a valid cellphone';			$formValid = false;			}	}	if(isset($_POST['application_telephone']) && trim($_POST['application_telephone']) != '') {		if($applicationObject->validateCell(trim($_POST['application_telephone'])) == '') {			$errorArray['application_telephone'] = 'Needs to be a valid cellphone';			$formValid = false;			}	}		if(isset($_POST['application_birthdate']) && trim($_POST['application_birthdate']) == '') {		$errorArray['application_birthdate'] = 'Birth date is required';		$formValid = false;			}		/* Company details. */	if(isset($_POST['application_entity_name']) && trim($_POST['application_entity_name']) == '') {		$errorArray['application_entity_name'] = 'Company name required';		$formValid = false;			}		if(isset($_POST['application_entity_number']) && trim($_POST['application_entity_number']) == '') {		$errorArray['application_entity_number'] = 'Company registration number required';		$formValid = false;			}		if(isset($_POST['application_entity_beelevel']) && trim($_POST['application_entity_beelevel']) == '') {		$errorArray['application_entity_beelevel'] = 'Company BBEE level required';		$formValid = false;			}		if(isset($_POST['application_entity_type']) && trim($_POST['application_entity_type']) == '') {		$errorArray['application_entity_type'] = 'Company entity type required';		$formValid = false;			}			if(isset($_POST['category_code']) && trim($_POST['category_code']) == '') {		$errorArray['category_code'] = 'Company industry required';		$formValid = false;			}			if(isset($_POST['application_entity_physical']) && trim($_POST['application_entity_physical']) == '') {		$errorArray['application_entity_physical'] = 'Company physical address required';		$formValid = false;			}		if(isset($_POST['areapost_code']) && trim($_POST['areapost_code']) == '') {		$errorArray['areapost_code'] = 'Postal code required';		$formValid = false;			}			if(isset($_POST['application_entity_telephone']) && trim($_POST['application_entity_telephone']) != '') {		if($applicationObject->validateCell(trim($_POST['application_entity_telephone'])) == '') {			$errorArray['application_entity_telephone'] = 'Company number to be a valid cellphone';			$formValid = false;			}	}		if(isset($_POST['application_entity_years']) && (int)trim($_POST['application_entity_years']) == 0) {		$errorArray['application_entity_years'] = 'Year(s) in operation is/are required';		$formValid = false;	}		if(count($errorArray) == 0 && $formValid == true) {		$data 	= array();						$data['areapost_code']			= trim($_POST['areapost_code']);				$data['year_code']					= trim($_POST['year_code']);			$data['application_name']		= trim($_POST['application_name']);				$data['application_surname']	= trim($_POST['application_surname']);					$data['application_email']		= trim($_POST['application_email']);		$data['application_cellphone']	= trim($_POST['application_cellphone']);			$data['application_birthdate']	= trim($_POST['application_birthdate']);			$data['application_title']			= trim($_POST['application_title']);					$data['application_telephone']	= trim($_POST['application_telephone']);			$data['application_entity_name']			= trim($_POST['application_entity_name']);			$data['application_entity_number']		= trim($_POST['application_entity_number']);			$data['application_entity_tax']				= trim($_POST['application_entity_tax']);			$data['application_entity_type']			= trim($_POST['application_entity_type']);			$data['category_code']						= trim($_POST['category_code']);			$data['application_entity_beelevel']		= trim($_POST['application_entity_beelevel']);			$data['application_entity_years']			= trim($_POST['application_entity_years']);			$data['application_entity_physical']		= trim($_POST['application_entity_physical']);			$data['application_entity_postal']			= trim($_POST['application_entity_postal']);			$data['application_entity_telephone']	= trim($_POST['application_entity_telephone']);			$data['application_entity_twitter']		= trim($_POST['application_entity_twitter']);					$data['application_entity_website']		= trim($_POST['application_entity_website']);							if(isset($applicationData)) {			/*Update. */			$where		= $applicationObject->getAdapter()->quoteInto('application_code = ?', $applicationData['application_code']);			$success	= $applicationObject->update($data, $where);		} else {			$success	= $applicationObject->insert($data);		}				if(count($errorArray) == 0) {			header('Location: /awards/entryapplication/');				exit;				}	}	/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	}$smarty->display('awards/entryapplication/details.tpl');?>