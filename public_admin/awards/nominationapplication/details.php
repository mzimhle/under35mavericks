<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/*** Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/*** Check for login */require_once 'includes/auth.php';/* objects. */require_once 'class/application.php';require_once 'class/category.php';require_once 'class/year.php';$applicationObject 	= new class_application();$categoryObject 	= new class_category();$yearObject 			= new class_year();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$applicationData = $applicationObject->getByCode($code);	if($applicationData) {		$smarty->assign('applicationData', $applicationData);	} else {		header('Location: /awards/nominationapplication/');		exit;			}}$categoryData = $categoryObject->pairs();if($categoryData) $smarty->assign('categoryData', $categoryData);$yearData = $yearObject->pairs();if($yearData) $smarty->assign('yearData', $yearData);/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;	$areaByName	= NULL;		/* Nominator details. */	if(isset($_POST['application_nominator_name']) && trim($_POST['application_nominator_name']) == '') {		$errorArray['application_nominator_name'] = 'Name required';		$formValid = false;			}	if(isset($_POST['application_nominator_email']) && trim($_POST['application_nominator_email']) != '') {		if($applicationObject->validateEmail(trim($_POST['application_nominator_email'])) == '') {			$errorArray['application_nominator_email'] = 'Needs to be a valid email address';			$formValid = false;			}	} else {		$errorArray['application_nominator_email'] = 'Please add an email address';		$formValid = false;				}		if(isset($_POST['application_nominator_cellphone']) && trim($_POST['application_nominator_cellphone']) != '') {		if($applicationObject->validateCell(trim($_POST['application_nominator_cellphone'])) == '') {			$errorArray['application_nominator_cellphone'] = 'Needs to be a valid cellphone';			$formValid = false;			}	}	if(isset($_POST['application_nominator_telephone']) && trim($_POST['application_nominator_telephone']) != '') {		if($applicationObject->validateCell(trim($_POST['application_nominator_telephone'])) == '') {			$errorArray['application_nominator_telephone'] = 'Needs to be a valid telephone';			$formValid = false;			}	}		if(isset($_POST['application_nominator_relationship']) && trim($_POST['application_nominator_relationship']) == '') {		$errorArray['application_nominator_relationship'] = 'What is the nominator relationship to the nominee';		$formValid = false;			} 		if(isset($_POST['application_nominator_area']) && trim($_POST['application_nominator_area']) == '') {		$errorArray['application_nominator_area'] = 'Nominator area is required';		$formValid = false;			}		/* People details. */	if(isset($_POST['year_code']) && trim($_POST['year_code']) == '') {		$errorArray['year_code'] = 'Application year is required';		$formValid = false;			}		if(isset($_POST['application_name']) && trim($_POST['application_name']) == '') {		$errorArray['application_name'] = 'Name required';		$formValid = false;			}		if(isset($_POST['application_surname']) && trim($_POST['application_surname']) == '') {		$errorArray['application_surname'] = 'surname required';		$formValid = false;			}		if(isset($_POST['application_title']) && trim($_POST['application_title']) == '') {		$errorArray['application_title'] = 'Business title of applicant required';		$formValid = false;			}		if(isset($_POST['application_email']) && trim($_POST['application_email']) != '') {		if($applicationObject->validateEmail(trim($_POST['application_email'])) == '') {			$errorArray['application_email'] = 'Needs to be a valid email address';			$formValid = false;			}	} else {		$errorArray['application_email'] = 'Please add an email address';		$formValid = false;				}		if(isset($_POST['application_cellphone']) && trim($_POST['application_cellphone']) != '') {		if($applicationObject->validateCell(trim($_POST['application_cellphone'])) == '') {			$errorArray['application_cellphone'] = 'Needs to be a valid cellphone';			$formValid = false;			}	}	if(isset($_POST['application_telephone']) && trim($_POST['application_telephone']) != '') {		if($applicationObject->validateCell(trim($_POST['application_telephone'])) == '') {			$errorArray['application_telephone'] = 'Needs to be a valid cellphone';			$formValid = false;			}	}		/* Company details. */	if(isset($_POST['application_entity_name']) && trim($_POST['application_entity_name']) == '') {		$errorArray['application_entity_name'] = 'Company name required';		$formValid = false;			}		if(isset($_POST['category_code']) && trim($_POST['category_code']) == '') {		$errorArray['category_code'] = 'Company industry required';		$formValid = false;			}			if(isset($_POST['areapost_code']) && trim($_POST['areapost_code']) == '') {		$errorArray['areapost_code'] = 'Postal code required';		$formValid = false;			}			if(count($errorArray) == 0 && $formValid == true) {		$data 	= array();								$data['year_code']										= trim($_POST['year_code']);			$data['application_nominator_name']			= trim($_POST['application_nominator_name']);				$data['application_nominator_email']			= trim($_POST['application_nominator_email']);					$data['application_nominator_cellphone']		= trim($_POST['application_nominator_cellphone']);		$data['application_nominator_telephone']		= trim($_POST['application_nominator_telephone']);			$data['application_nominator_relationship']	= trim($_POST['application_nominator_relationship']);			$data['application_nominator_area']			= trim($_POST['application_nominator_area']);					$data['application_name']			= trim($_POST['application_name']);			$data['application_surname']		= trim($_POST['application_surname']);			$data['application_title']				= trim($_POST['application_title']);			$data['application_email']			= trim($_POST['application_email']);			$data['application_cellphone']		= trim($_POST['application_cellphone']);				$data['application_telephone']		= trim($_POST['application_telephone']);		$data['areapost_code']				= trim($_POST['areapost_code']);								$data['category_code']				= trim($_POST['category_code']);		$data['application_entity_name']	= trim($_POST['application_entity_name']);					if(isset($applicationData)) {			$where		= $applicationObject->getAdapter()->quoteInto('application_code = ?', $applicationData['application_code']);			$success	= $applicationObject->update($data, $where);		} else {			$data['application_type']	= 'NOMINATION';			$success	= $applicationObject->insert($data);		}				if(count($errorArray) == 0) {			header('Location: /awards/nominationapplication/');				exit;				}	}	/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	}$smarty->display('awards/nominationapplication/details.tpl');?>