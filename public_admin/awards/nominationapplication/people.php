<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/** * Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/** * Check for login */require_once 'includes/auth.php';/* objects. */require_once 'class/application.php';require_once 'class/companypeople.php';$applicationObject 			= new class_application();$companypeopleObject	= new class_companypeople();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$applicationData = $applicationObject->getByCode($code);	if($applicationData) {						$smarty->assign('applicationData', $applicationData);			} else {		header('Location: /awards/nominationapplication/');		exit;			}} else {	header('Location: /awards/nominationapplication/');	exit;}$companypeopleData = $companypeopleObject->getByType('APPLICATION', $code);if($companypeopleData) $smarty->assign('companypeopleData', $companypeopleData);/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;	$areaByName	= NULL;		/* People details. */		if(isset($_POST['companypeople_name']) && trim($_POST['companypeople_name']) == '') {		$errorArray['companypeople_name'] = 'Name is required';		$formValid = false;			}		if(isset($_POST['companypeople_surname']) && trim($_POST['companypeople_surname']) == '') {		$errorArray['companypeople_surname'] = 'Surname is required';		$formValid = false;			}		if(isset($_POST['companypeople_designation']) && trim($_POST['companypeople_designation']) == '') {		$errorArray['companypeople_designation'] = 'Designation is required';		$formValid = false;			}		if(isset($_POST['companypeople_birthdate']) && trim($_POST['companypeople_birthdate']) == '') {		$errorArray['companypeople_birthdate'] = 'Birth date is required';		$formValid = false;			}		if(count($errorArray) == 0 && $formValid == true) {		$data 	= array();						$data['companypeople_type']				= 'APPLICATION';				$data['companypeople_reference']		= $applicationData['application_code'];			$data['companypeople_name']			= trim($_POST['companypeople_name']);				$data['companypeople_surname']		= trim($_POST['companypeople_surname']);					$data['companypeople_designation']	= trim($_POST['companypeople_designation']);		$data['companypeople_birthdate']		= trim($_POST['companypeople_birthdate']);						$success	= $companypeopleObject->insert($data);						if(count($errorArray) == 0) {			header('Location: /awards/nominationapplication/people.php?code='.$applicationData['application_code']);				exit;				}	}	/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	} if(isset($_GET['delete_code'])) {		$errorArray				= array();	$errorArray['error']	= '';	$errorArray['result']	= 0;		$formValid				= true;	$success					= NULL;	$personcode				= trim($_GET['delete_code']);		if($errorArray['error']  == '' && $errorArray['result']  == 0 ) {		$data	= array();		$data['companypeople_deleted'] = 1;				$where		= array();		$where[] 	= $companypeopleObject->getAdapter()->quoteInto('companypeople_code = ?', $personcode);		$where[] 	= $companypeopleObject->getAdapter()->quoteInto('companypeople_reference = ?', $applicationData['application_code']);		$where[] 	= $companypeopleObject->getAdapter()->quoteInto('companypeople_type = ?', 'APPLICATION');		$success	= $companypeopleObject->update($data, $where);					if(is_numeric($success) && $success > 0) {			$errorArray['error']	= '';			$errorArray['result']	= 1;					} else {			$errorArray['error']	= 'Could not change status, please try again.';			$errorArray['result']	= 0;						}	}		echo json_encode($errorArray);	exit;}$smarty->display('awards/nominationapplication/people.tpl');?>