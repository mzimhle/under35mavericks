<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/*** Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/*** Check for login */require_once 'includes/auth.php';/* objects. */require_once 'class/gallery.php';require_once 'class/year.php';$galleryObject	= new class_gallery();$yearObject 		= new class_year();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$galleryData = $galleryObject->getByCode($code);		if($galleryData) {		$smarty->assign('galleryData', $galleryData);	} else {		header('Location: /awards/galleries/');		exit;			}}$yearData = $yearObject->pairs();if($yearData) $smarty->assign('yearData', $yearData);/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;		if(isset($_POST['gallery_name']) && trim($_POST['gallery_name']) == '') {		$errorArray['gallery_name'] = 'Name required';		$formValid = false;			}		if(isset($_POST['year_code']) && trim($_POST['year_code']) == '') {		$errorArray['year_code'] = 'Year required';		$formValid = false;			}		if(isset($_POST['gallery_description']) && trim($_POST['gallery_description']) == '' ) {		$errorArray['gallery_description'] = 'Description is required';		$formValid = false;			} else if(strlen(trim($_POST['gallery_description'])) < 0 || trim($_POST['gallery_description']) > 255) {		$errorArray['gallery_description'] = 'characters need to be less than 255 characters';		$formValid = false;				}	if(count($errorArray) == 0 && $formValid == true) {				$data 	= array();						$data['gallery_name']		= trim($_POST['gallery_name']);				$data['year_code']				= trim($_POST['year_code']);		$data['gallery_description']	= trim($_POST['gallery_description']);					if(isset($galleryData)) {			/*Update. */			$where		= $galleryObject->getAdapter()->quoteInto('gallery_code = ?', $galleryData['gallery_code']);			$success	= $galleryObject->update($data, $where);									$success 	= $galleryData['gallery_code'];		} else {			$data['gallery_type']		= 'AWARDS';			$success = $galleryObject->insert($data);		}		if(count($errorArray) == 0) {			header('Location: /awards/galleries/image.php?code='.$success);				exit;				}	}		/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	}$smarty->display('awards/galleries/details.tpl');?>